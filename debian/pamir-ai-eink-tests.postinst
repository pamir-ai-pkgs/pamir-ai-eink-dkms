#!/bin/sh
set -e

case "$1" in
    configure)
        # Set proper permissions for test programs
        if [ -d /opt/distiller-eink-tests ]; then
            # Make all binaries executable
            find /opt/distiller-eink-tests/bin -type f -exec chmod 755 {} \;
            
            # Make Python scripts executable
            find /opt/distiller-eink-tests/python -name "*.py" -exec chmod 755 {} \;
            
            # Set ownership to root but allow video group access
            chown -R root:video /opt/distiller-eink-tests
            
            # Allow video group to access framebuffer
            chmod 750 /opt/distiller-eink-tests/bin/*
            
            # Create symlinks in /usr/local/bin for easy access
            for prog in /opt/distiller-eink-tests/bin/*; do
                if [ -f "$prog" ] && [ -x "$prog" ]; then
                    basename=$(basename "$prog")
                    ln -sf "$prog" "/usr/local/bin/eink-$basename" 2>/dev/null || true
                fi
            done
            
            # Add PATH suggestion
            echo ""
            echo "E-Ink test programs installed to /opt/distiller-eink-tests/"
            echo "Programs are also available as eink-* commands in /usr/local/bin"
            echo ""
            echo "To use the test programs, ensure your user is in the video group:"
            echo "  sudo usermod -a -G video \$USER"
            echo ""
            echo "Available test programs:"
            echo "  eink-demo      - Basic demonstration"
            echo "  eink-clock     - Real-time clock display"
            echo "  eink-monitor   - System resource monitor"
            echo "  eink-weather   - Weather dashboard (requires API key)"
            echo "  eink-reader    - E-book reader"
            echo ""
        fi
        ;;
    
    abort-upgrade|abort-remove|abort-deconfigure)
        ;;
    
    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

#DEBHELPER#

exit 0